@model hotel_bookings.Models.ServiceRoomViewModel



@{

    string check_in = ViewBag.CheckIn;
    string check_out = ViewBag.CheckOut;
    double day = ViewBag.Day;

}
@{
    ViewBag.Title = "RoomService";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<style>
</style>
<script>

$(document).ready(function () {
    // Thêm sự kiện click cho nút tăng
    $(".increase").click(function () {
        // Tìm ô nhập liệu tương ứng
        var input = $(this).closest(".input-group").find(".quantity");
        // Lấy giá trị hiện tại và tăng lên 1 đơn vị
        var currentValue = parseInt(input.val());
        if (!isNaN(currentValue)) {
            input.val(currentValue + 1);
        }
    });

    // Thêm sự kiện click cho nút giảm
    $(".decrease").click(function () {
        // Tìm ô nhập liệu tương ứng
        var input = $(this).closest(".input-group").find(".quantity");
        // Lấy giá trị hiện tại và giảm đi 1 đơn vị
        var currentValue = parseInt(input.val());
        if (!isNaN(currentValue) && currentValue > 1) {
            input.val(currentValue - 1);
        }
    });
    // Initialize an empty array to store checked options
    var checkedOptions = [];
    var checkedOptionsPrice = [];

    // Function to update the array when a checkbox is checked or unchecked
    function updateCheckedOptions(price,optionId, isChecked) {
        if (isChecked) {
            // Add the optionId to the array if checked
            checkedOptions.push(optionId);
            checkedOptionsPrice.push(price)
        } else {
            // Xóa optionId khỏi mảng nếu không được chọn
            var index = checkedOptions.indexOf(optionId);
            var indexPrice = checkedOptionsPrice.indexOf(price);
            if (index !== -1) {
                checkedOptions.splice(index, 1);
                checkedOptionsPrice.splice(indexPrice, 1);
            }
        }
    }

    // Function to generate HTML content for each checked option
    function generateHTMLContent(option) {
        var content = '<ul style="padding: 0 0 0 20px; list-style-type: disc;">';
        content += '<li>';
        content += '<div style="font-weight: 400; font-size: 12px; line-height: 140%; display: flex; align-items: center; justify-content: space-between; color: #353c46;">';
        //content += '<span style="width: 70%;">' + 'X' + '<span id="count'+option.id+'"style="width: 70%;">'+option.count+'</span>' + '  ' + option.name + '</span>';
        content += '<span style="width: 70%;">' + option.name + '</span>';
        //content += '<span style="width: 30%; text-align: right; font-weight: 500;"><span>' + option.price + 'đ</span></span>';
        content += '</div>';
        content += '</li>';
        content += '</ul>';
        return content;

    }

    var count = 1;
    var svID = 1;
    document.querySelectorAll('input[type="number"]').forEach(input => {
        input.addEventListener('change', function (event) {
            const itemId = event.target.getAttribute('data-item-id');
            const newValue = event.target.value;
            count = newValue
            svID = itemId
            var a = "'" + "#" +"count" + svID + "'";
            console.log(`Item ID: ${itemId},  New Value: ${a}`);
        });
    });
    // Bắt sự kiện khi checkbox thay đổi trạng thái
    $("[id^='myCheckbox']").change(function () {
        //var optionName = $(this).attr('id').split('_')[1];
        //var optionPrice = $(this).attr('id').split(':')[1];
        var name = event.target.getAttribute('data-item-name');
        var optionPrice = event.target.getAttribute('data-item-price');
        var optionName = name + ': ' + optionPrice * count;
        var optionID = $(this).value
        console.log(`New Value: ${optionPrice   }`);

        var price = parseFloat(optionPrice * count)
        var isChecked = $(this).prop('checked'); // Kiểm tra trạng thái checked của checkbox
        updateCheckedOptions( price, optionName, isChecked);

        // Xóa nội dung cũ trong #item_service
        $('#item_service').empty();
        // Duyệt qua mảng checkedOptions và thêm nội dung HTML tương ứng vào #item_service
        checkedOptions.forEach(function (optionName, optionID) {

            var option = { name: optionName, id: optionID, count: count }; // Thay bằng thông tin thực tế của option
            var content = generateHTMLContent(option);

            $('#item_service').append(content);
            $('#price').html(price);
        });

        var price1 = 0;
        if ($("[id^='myCheckbox']:checked").length > 0) {
            checkedOptionsPrice.forEach(function (price) {
            price1 += price;
            price2 = @(Model.roomPriceAll * day)+price1
            $('#price').html(price2);
            });
        } else
            $('#price').html(@(Model.roomPriceAll * day));




    });

});
    $(document).ready(function () {
        $('#myForm').submit(function (event) {
            // Ngăn chặn hành vi mặc định của form (chẳng hạn, tải lại trang)

            // Tạo một mảng để lưu trữ dữ liệu các mặt hàng đã chọn
            var selectedItems = [];

            // Lặp qua mỗi checkbox để kiểm tra xem nó có được chọn hay không
            $('input[name="selectedOption"]:checked').each(function () {
                var itemId = $(this).val(); // Lấy giá trị của checkbox
                var quantity = $(this).closest('.col-sm-4').find('input[type="number"]').val(); // Lấy số lượng tương ứng

                // Thêm một đối tượng vào mảng selectedItems
                selectedItems.push({
                    itemId: itemId,
                    quantity: quantity
                });
            });

            // Gửi danh sách selectedItems bằng AJAX
            $.ajax({
                type: 'POST',
                url: '@Url.Action("RoomService", "Room")', // Đường dẫn của endpoint để xử lý dữ liệu đã chọn
                data: { selectedItems: selectedItems },
                success: function (response) {
                    // Xử lý kết quả nếu cần thiết
                },
                error: function (xhr, status, error) {
                    // Xử lý lỗi nếu có
                }
            });
        });
    });




</script>
<!-- Breadcrumb Section Begin -->
<div class="breadcrumb-section">
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <div class="breadcrumb-text">
                    <h2>Thêm dịch vụ</h2>
                    <div class="bt-option">
                        <a href="./home.html">Trang chủ</a>
                        <span>Phòng</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Breadcrumb Section End -->
<!-- Room Details Section Begin -->
<section class="room-details-section spad">
    <div class="container">
        <form method="post" id="myForm">

            <div class="row">
                <div class="col-lg-8">
                    <div class="row" style="display: flex; flex-wrap: wrap; grid-row-gap: 20px; row-gap: 20px; grid-column-gap: 12px; -webkit-column-gap: 12px; column-gap: 12px;">
                        @foreach (var item in Model.services)
                        {
                            <div class="col-sm-4" style="border-top-left-radius: 4px; border-top-right-radius: 4px; width: calc(33.33% - 8px); overflow: hidden;">
                                <div style="border-radius: 4px 4px 0 0; height: 168px; background-color: #fff; position: relative;">
                                    <img src="~/Assets/img/services/@item.image" data-was-processed="true" style="width: 100%; height: 100%; object-fit: cover;">
                                </div>
                                <div style="display: flex; flex-direction: column; justify-content: space-between; border: 1px solid #e0e0e0; border-radius: 4px; margin-top: -12px; padding: 25px 12px 16px; height: 180px;">
                                    <div style="font-weight: 400; font-size: 14px; line-height: 21px; color: #353c46; overflow: hidden; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; min-height: 41px;">@item.name</div>
                                    <div>
                                        <div style="  font-weight: 500; font-size: 18px; line-height: 24px; color: #353c46; margin-top: 8px;">
                                            <span>@item.price<span>đ</span></span>

                                            <div style="margin-top:10px; font-weight: 400; font-size: 12px; line-height: 24px; color: #2a398c; display: flex; cursor: pointer;">
                                                <span>Số lượng: </span>
                                                <input data-item-id="@item.id" style="color: #dfa974; font-size: 18px; margin-left: 10px; width: 35px; border: none " type="number" min="1" max="5" step="1" value="1">
                                            </div>
                                        </div>

                                        <div style="margin-top: 6px; display: flex; justify-content: space-between;">
                                            <div style=" font-weight: 400; font-size: 12px; line-height: 24px; color: #2a398c; display: flex; cursor: pointer;">
                                                <img alt="" src="/static/media/fi-br-info.3bd2636e.svg">
                                                <span>Chi tiết</span>
                                            </div>
                                            <div>
                                                <label>
                                                    <span>
                                                        <input data-item-name="@item.name" data-item-price="@item.price" id="myCheckbox" type="checkbox" name="selectedOption" value="@item.id">
                                                        <span style="font-weight: 500; font-size: 14px; line-height: 24px; color: #e8952f;">Thêm</span>
                                                    </span>
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        }

                       
                    </div>
                </div>
                <div class="col-lg-4">
                    <div style="border: 1px solid #c8c8c8; border-radius: 10px;">
                        <div>
                            <p style=" margin: 0; padding: 10px; font-size: 20px; text-align: center; border-bottom: 1px solid #c8c8c8; background-color: #f3f2f2; ">
                                Đặt phòng
                            </p>
                        </div>
                        <div style=" padding: 20px;">
                            <div>
                                <div style="border-bottom: 2px solid #c8c8c8;">
                                    <div>
                                        <p style="margin-bottom: 0; color: #000000;">Thời gian đặt phòng</p>
                                    </div>
                                    <div>
                                        <p style="margin-bottom: 0;">Thời gian: Từ: @check_in - đến:  @check_out</p>
                                    </div>
                                    <p>Số đêm lưu trú: @day Đêm</p>
                                </div>
                                <div style="margin-top: 10px; border-bottom: 2px solid #c8c8c8;">
                                    @foreach (var item in Model.rooms)
                                    {
                                        <p style="margin-bottom: 0; color: #000000;">Phòng:</p>
                                        <div class="row">
                                            <p class="col-sm-7" style="margin-bottom: 0; padding-right: 20px;">@item.name</p>
                                            <p class="col-sm-5" style="margin-bottom: 0;"><span style="float: right;">@(item.price * day) đ</span></p>
                                        </div>
                                        <div>
                                            <p style="margin-bottom: 0;">@item.adult Người lớn</p>
                                            <p>@item.children Người trẻ em</p>
                                        </div>

                                    }

                                    <div>
                                        <div id="item_service" style="background: #f4f6f9;">

                                        </div>
                                    </div>

                                </div>

                            </div>
                            <div style="display: flex; margin: 10px 0;">
                                <div>
                                    <span style="margin-bottom: 0;">Tổng cộng:</span>
                                    <p style="margin-bottom: 0; font-size: 13px;">(Bao gồm thuế phí)</p>
                                </div>
                                <div>
                                    <p id="price" style="color: #dfa974; font-size: 24px; margin-left: 75px;">@(Model.roomPriceAll * day) đ</p>
                                </div>
                            </div>
                            <div>
                                <button type="submit" style="display: inline-block; color: #ffffff; font-size: 13px; text-transform: uppercase; font-weight: 700; background: #dfa974; padding: 14px 28px 13px; width: 100%; text-align: center; border-radius: 30px; ">
                                    Tiếp tục
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </form>

    </div>
</section>
<!-- Room Details Section End -->
